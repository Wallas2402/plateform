<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-6xl mx-auto bg-white rounded shadow p-6">
    <h1 class="text-2xl font-bold mb-4">Orders Management</h1>

    <div class="flex justify-between mb-4">
      <button onclick="exportToCSV()" class="bg-green-600 text-white px-4 py-2 rounded">Export CSV</button>
      <button onclick="clearAll()" class="bg-red-600 text-white px-4 py-2 rounded">Clear All Orders</button>
    </div>

    <div id="ordersList" class="space-y-4">
      <!-- Orders will be displayed here -->
    </div>
  </div>

  <script>
    const STATUS = ["Pending", "Confirmed", "Canceled"];

    function loadOrders() {
      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      const list = document.getElementById("ordersList");
      list.innerHTML = "";

      if (orders.length === 0) {
        list.innerHTML = "<p class='text-gray-500'>No orders found.</p>";
        return;
      }

      orders.forEach((order, index) => {
        const div = document.createElement("div");
        div.className = "border border-black p-4 rounded bg-gray-50";

        div.innerHTML = `
          <p><strong>Full Name:</strong> ${order.first_name} ${order.last_name}</p>
          <p><strong>Phone:</strong> ${order.phone}</p>
          <p><strong>Wilaya:</strong> ${order.wilaya}</p>
          <p><strong>Address:</strong> ${order.address}</p>
          <p><strong>Quantity:</strong> ${order.quantity}</p>
          <p><strong>Product:</strong> ${order.product}</p>

          <label class="block mt-2">Status:
            <select onchange="updateStatus(${index}, this.value)" class="border border-black p-1 rounded mt-1">
              ${STATUS.map(s => `<option value="${s}" ${s === order.status ? "selected" : ""}>${s}</option>`).join("")}
            </select>
          </label>

          <button onclick="deleteOrder(${index})" class="mt-2 bg-red-500 text-white px-3 py-1 rounded">Delete</button>
        `;

        list.appendChild(div);
      });
    }

    function updateStatus(index, newStatus) {
      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      orders[index].status = newStatus;
      localStorage.setItem("orders", JSON.stringify(orders));
      loadOrders();
    }

    function deleteOrder(index) {
      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      if (confirm("Are you sure you want to delete this order?")) {
        orders.splice(index, 1);
        localStorage.setItem("orders", JSON.stringify(orders));
        loadOrders();
      }
    }

    function clearAll() {
      if (confirm("Delete all orders?")) {
        localStorage.removeItem("orders");
        loadOrders();
      }
    }

    function exportToCSV() {
      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      if (orders.length === 0) return alert("No data to export!");

      const headers = Object.keys(orders[0]);
      const rows = orders.map(o => headers.map(h => `"${(o[h] || "").replace(/"/g, '""')}"`).join(","));
      const csvContent = [headers.join(","), ...rows].join("\n");

      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.setAttribute("href", URL.createObjectURL(blob));
      link.setAttribute("download", "orders.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    loadOrders();
  </script>
</body>
</html>
